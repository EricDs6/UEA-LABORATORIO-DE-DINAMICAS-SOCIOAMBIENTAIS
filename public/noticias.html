<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notícias</title>
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>
  <h1>Notícias</h1>
  <div id="noticias-list"></div>
  <script type="module">
    import { createClient } from 'https://esm.sh/@sanity/client@5.18.2'
    const client = createClient({
      projectId: 'c57wcy5u', // Substitua pelo seu Project ID do Sanity
      dataset: 'production',
      apiVersion: '2023-01-01',
      useCdn: true
    });
    async function carregarNoticias() {
      const query = `*[_type == "post"]|order(publishedAt desc)[0...10]{
        title,
        slug,
        publishedAt,
        'imageUrl': mainImage.asset->url,
        body
      }`;
      const posts = await client.fetch(query);
      const container = document.getElementById('noticias-list');
      if(posts.length === 0) {
        container.innerHTML = '<p>Nenhuma notícia encontrada.</p>';
        return;
      }
      container.innerHTML = posts.map(post => `
        <article style="margin-bottom:2em;">
          <h2>${post.title}</h2>
          ${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" style="max-width:300px;">` : ''}
          <p><small>${new Date(post.publishedAt).toLocaleDateString('pt-BR')}</small></p>
          <div>${post.body && post.body[0] && post.body[0].children ? post.body[0].children.map(c => c.text).join(' ') : ''}</div>
        </article>
      `).join('');
    }
    carregarNoticias();
  </script>
</body>
</html>
